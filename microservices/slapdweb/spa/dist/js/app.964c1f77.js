(function(t){function e(e){for(var o,i,a=e[0],c=e[1],l=e[2],d=0,m=[];d<a.length;d++)i=a[d],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&m.push(s[i][0]),s[i]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);u&&u(e);while(m.length)m.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],o=!0,a=1;a<n.length;a++){var c=n[a];0!==s[c]&&(o=!1)}o&&(r.splice(e--,1),t=i(i.s=n[0]))}return t}var o={},s={app:0},r=[];function i(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=o,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var l=0;l<a.length;l++)e(a[l]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";n("85ec")},"16d9":function(t,e,n){},"224b":function(t,e,n){},"23a6":function(t,e,n){},"3d09":function(t,e,n){"use strict";n("16d9")},"3d6e":function(t,e,n){"use strict";n("608b")},5080:function(t,e,n){"use strict";n("7b4c")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("MsgBox",{attrs:{msgIn:t.msgIn,callback:t.reset_msg}}),n("div",{staticClass:"headBlock"},[n("div",{attrs:{css:"hl"}},[t._v("VDI Stack - User Management WebUi")]),n("div",{staticClass:"btnBar"},[n("div",{on:{click:t.open_vdi_url}},[t._v("vdi gui")]),!1!==t.usr?n("div",{on:{click:t.logout}},[t._v("logout")]):t._e()])]),0==t.usr?n("LoginForm",{attrs:{callback:t.set_usr}}):t._e(),0!=t.usr?n("UserTable"):t._e()],1)},r=[],i=(n("d3b7"),function(){var t=this,e=this,n=e.$createElement,o=e._self._c||n;return""!=e.msgIn?o("div",{staticClass:"blocker"},[o("div",{staticClass:"msgBox"},[o("div",{attrs:{css:"hl"}},[e._v("System Message")]),o("div",{attrs:{css:"msg"}},[e._v(" "+e._s(e.msgIn)+" ")]),void 0==e.fw_func?o("div",{attrs:{css:"btnFrame"}},[o("button",{on:{click:e.callback}},[e._v("ok")])]):e._e(),void 0!=e.fw_func?o("div",{attrs:{css:"btnFrame"}},[o("button",{on:{click:function(){t.fw_func(),t.callback()}}},[e._v("ok")]),o("button",{on:{click:e.callback}},[e._v("cancel")])]):e._e()])]):e._e()}),a=[],c={name:"MsgBox",props:{msgIn:String,fw_func:Function,callback:Function},data:function(){return{}},mounted:function(){},methods:{}},l=c,u=(n("dea2"),n("2877")),d=Object(u["a"])(l,i,a,!1,null,"2da1cd3f",null),m=d.exports,p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("MsgBox",{attrs:{msgIn:t.msgIn,callback:t.reset_msg}}),n("div",{staticClass:"loginForm",on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.auth_submit(e)}}},[n("div",{attrs:{css:"hl"}},[t._v("Admin Login")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.usr,expression:"usr"}],attrs:{type:"text",id:"usrIpt",placeholder:"User Name or Distinguished Name"},domProps:{value:t.usr},on:{input:function(e){e.target.composing||(t.usr=e.target.value)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.pwd,expression:"pwd"}],attrs:{type:"password",id:"pwdIpt",placeholder:"Password"},domProps:{value:t.pwd},on:{input:function(e){e.target.composing||(t.pwd=e.target.value)}}}),n("div",{attrs:{css:"btnFrame"}},[n("button",{on:{click:t.auth_submit}},[t._v("submit")])])])],1)},f=[],h={name:"LoginForm",components:{MsgBox:m},props:{msg:String,callback:Function},data:function(){return{usr:"",pwd:"",msgIn:""}},methods:{auth_submit:function(){var t=this,e=/[ `!@#$%^&*()_+\-\[\]{};':"\\|.<>\/?~]/;function n(t){var e=t.style.borderColor;t.style.borderColor="red",setTimeout((function(){t.style.borderColor=e}),800)}var o=document.getElementById("usrIpt"),s=document.getElementById("pwdIpt");if(e.test(o.value)||""==o.value)return n(o),null;if(""==s.value)return n(s),null;var r={uid:this.usr,pwd:this.pwd};fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((function(t){return t.json()})).then((function(e){console.log("Response:",e),200!=e.status?(t.usr="",t.pwd="",t.msgIn="Login Failed"):t.callback(t.usr)})).catch((function(t){console.error("Error:",t)}))},reset_msg:function(){this.msgIn=""}}},g=h,v=(n("3d09"),Object(u["a"])(g,p,f,!1,null,"582e0a8b",null)),_=v.exports,w=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("MsgBox",{attrs:{msgIn:t.msgIn,callback:t.reset_msg,fw_func:t.fw_func}}),"edit"==t.activeAct||"create"==t.activeAct?n("UserEdit",{attrs:{act:t.activeAct,usr:t.activeEdit,reload:t.get_usr_data,callback:t.reset_act}}):t._e(),"setpwd"==t.activeAct?n("UserPassword",{attrs:{usr:t.activeEdit,callback:t.reset_act}}):t._e(),n("table",{staticClass:"stdTable"},[n("tr",[t._l(t.defi,(function(e,o){return n("th",{key:o,style:{textAlign:e.align}},[t._v(t._s(e.hl))])})),n("th",[t._v("Action")])],2),t._l(t.data,(function(e,o){return n("tr",{key:o},[t._l(t.defi,(function(o,s){return n("td",{key:s,style:{textAlign:o.align}},[t._v(t._s(e[o.col]))])})),n("td",[n("ActionMenu",{attrs:{uid:e.uid,activeMenu:t.activeMenu,set_active:t.set_active,func_forward:t.func_forward}})],1)],2)})),n("tr",[n("td",{attrs:{colspan:t.defi.length}},[n("button",{on:{click:t.guac_sync}},[t._v("sync with guacamole")])]),n("td",[n("button",{on:{click:t.form_user_create}},[t._v("add")])])])],2)],1)},b=[],y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"menuFrame",attrs:{tag:"menu"}},[n("div",{staticClass:"actMenuBtn",attrs:{tag:"menu"},on:{click:function(e){return t.set_active(t.uid)}}},[n("div",{attrs:{tag:"menu",css:"dot"}}),n("div",{attrs:{tag:"menu",css:"dot"}}),n("div",{attrs:{tag:"menu",css:"dot"}})]),t.activeMenu==t.uid?n("div",{staticClass:"actMenuFrame"},[n("div",{attrs:{css:"arrow"}}),t._l(t.menuActs,(function(e,o){return n("div",{key:o,attrs:{css:"btn"},on:{click:function(n){return t.func_forward(t.uid,e.act)}}},[t._v(t._s(e.txt))])}))],2):t._e()])},k=[],x={name:"ActionMenu",props:{activeMenu:String,uid:String,set_active:Function,func_forward:Function},data:function(){return{menuActs:[{txt:"Edit",act:"edit"},{txt:"Set Password",act:"setpwd"},{txt:"Delete",act:"delete"},{txt:"Memberships",act:"member"}]}},mounted:function(){},methods:{}},I=x,S=(n("f1ed"),Object(u["a"])(I,y,k,!1,null,"524793ba",null)),E=S.exports,O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"blocker"},[n("MsgBox",{attrs:{msgIn:t.msgIn,callback:t.reset_msg}}),n("div",{staticClass:"actionForm",on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.edit_submit(e)}}},[n("div",{attrs:{css:"hl"}},[t._v(t._s(t.act)+" user "+t._s(t.usr))]),t._l(t.defi,(function(e,o){return n("div",{key:o},[n("div",{attrs:{css:"elmHl"}},[t._v(t._s(e.hl))]),"text"==e.type?n("input",{directives:[{name:"model",rawName:"v-model",value:t.data[e.col],expression:"data[elm.col]"}],attrs:{type:"text",placeholder:e.placeholder,id:"elm_"+e.col},domProps:{value:t.data[e.col]},on:{input:function(n){n.target.composing||t.$set(t.data,e.col,n.target.value)}}}):t._e(),"static"==e.type?n("input",{directives:[{name:"model",rawName:"v-model",value:t.data[e.col],expression:"data[elm.col]"}],attrs:{type:"text",disabled:!0,id:"elm_"+e.col},domProps:{value:t.data[e.col]},on:{input:function(n){n.target.composing||t.$set(t.data,e.col,n.target.value)}}}):t._e(),"select"==e.type?n("select",{directives:[{name:"model",rawName:"v-model",value:t.data[e.col],expression:"data[elm.col]"}],attrs:{type:"dropdown",id:"elm_"+e.col},on:{change:function(n){var o=Array.prototype.filter.call(n.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.data,e.col,n.target.multiple?o:o[0])}}},t._l(e.options,(function(e,o){return n("option",{key:o,domProps:{value:e.val}},[t._v(" "+t._s(e.txt)+" ")])})),0):t._e()])})),n("div",{attrs:{css:"btnFrame"}},[n("button",{on:{click:t.edit_submit}},[t._v("submit")]),n("button",{on:{click:t.callback}},[t._v("cancel")])])],2)],1)},j=[],C=(n("4d63"),n("ac1f"),n("25f0"),{name:"UserEdit",components:{MsgBox:m},props:{act:String,usr:String,msg:String,callback:Function,reload:Function},data:function(){return{msgIn:"",defi:[{col:"uid",hl:"User ID",type:"static",placeholder:"no special characters",regex:"^[A-Za-z0-9-]*$"},{col:"cn",hl:"Common Name",type:"text",placeholder:"no special characters",regex:"^[A-Za-z0-9-]*$"},{col:"givenName",hl:"Firstname",type:"text",placeholder:"",regex:"^.{2,}$"},{col:"sn",hl:"Lastname",type:"text",placeholder:"",regex:"^.{2,}$"},{col:"homeDirectory",hl:"Home Directory",type:"text",placeholder:"local path",regex:"^\\/(.)+$"},{col:"loginShell",hl:"Shell",type:"text",placeholder:"e.g /bin/bash",regex:"^\\/(.)+$"},{col:"employeeType",hl:"Role",type:"select",placeholder:"",regex:"^(.)+$",options:[{val:"user",txt:"vdi user"},{val:"admin",txt:"vdi stack admin"}]}],data:{uid:"",cn:"",givenName:"",sn:"",homeDirectory:"",loginShell:"",employeeType:"user"}}},mounted:function(){"edit"==this.act&&this.call_userdata(),"create"==this.act&&(this.data["uid"]=this.usr)},methods:{reset_msg:function(){this.msgIn=""},call_userdata:function(){var t=this;fetch("/api/user/"+this.usr,{method:"GET"}).then((function(t){return t.json()})).then((function(e){console.log("Response:",e),e["data"]?t.data=e.data:t.msgIn="Something went wrong"})).catch((function(e){console.error("Error:",e),t.msgIn="Something went wrong"}))},edit_submit:function(){var t=this,e=!0,n={};for(var o in this.defi){var s=this.defi[o],r=new RegExp(s.regex),i=r.test(this.data[s.col]);i?n[s.col]=this.data[s.col]:(this.data[s.col]="",this.highlight_border_color("elm_"+s.col),e=!1)}e&&fetch("/api/user/"+this.act,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(t){return t.json()})).then((function(e){console.log("Response:",e),200!=e.status?t.msgIn="Something went wrong":(t.reload(),t.callback())})).catch((function(e){console.error("Error:",e),t.msgIn="Something went wrong"}))},highlight_border_color:function(t){var e=document.getElementById(t),n=e.style.borderColor;e.style.borderColor="red",setTimeout((function(){e.style.borderColor=n}),800)}}}),M=C,F=Object(u["a"])(M,O,j,!1,null,"74da017c",null),P=F.exports,T=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"blocker"},[n("MsgBox",{attrs:{msgIn:t.msgIn,callback:t.reset_msg}}),n("div",{staticClass:"actionForm",on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.pwdset_submit(e)}}},[n("div",{attrs:{css:"hl"}},[t._v("Set Password for user "+t._s(t.usr))]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.pwdIn,expression:"pwdIn"}],attrs:{type:"password",id:"pwdIn",placeholder:"Enter new password (min "+t.pwdLength+" characters)"},domProps:{value:t.pwdIn},on:{input:function(e){e.target.composing||(t.pwdIn=e.target.value)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.pwdRep,expression:"pwdRep"}],attrs:{type:"password",id:"pwdRep",placeholder:"Repeat new password"},domProps:{value:t.pwdRep},on:{input:function(e){e.target.composing||(t.pwdRep=e.target.value)}}}),n("div",{attrs:{css:"btnFrame"}},[n("button",{on:{click:t.pwdset_submit}},[t._v("submit")]),n("button",{on:{click:t.callback}},[t._v("cancel")])])])],1)},A=[],R={name:"UserPassword",components:{MsgBox:m},props:{usr:String,msg:String,callback:Function},data:function(){return{msgIn:"",pwdIn:"",pwdRep:"",pwdLength:4}},mounted:function(){},methods:{reset_msg:function(){this.msgIn=""},pwdset_submit:function(){var t=this;if(this.pwdIn.length<this.pwdLength)return this.highlight_border_color("pwdIn"),this.pwdIn="",this.pwdRep="",void(this.msgIn="Password to short");if(this.pwdIn!=this.pwdRep)return this.highlight_border_color("pwdRep"),this.pwdRep="",void(this.msgIn="Password repeat does not fit.");var e={uid:this.usr,pwd:this.pwdIn};fetch("/api/user/setpwd",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(t){return t.json()})).then((function(e){console.log("Response:",e),200==e.status?(t.msgIn="OK",t.callback()):t.msgIn="Something went wrong."})).catch((function(e){console.error("Error:",e),t.msgIn="Something went wrong."}))},highlight_border_color:function(t){var e=document.getElementById(t),n=e.style.borderColor;e.style.borderColor="red",setTimeout((function(){e.style.borderColor=n}),800)}}},B=R,$=(n("5080"),Object(u["a"])(B,T,A,!1,null,"181975ff",null)),N=$.exports,U={name:"UserTable",components:{ActionMenu:E,MsgBox:m,UserEdit:P,UserPassword:N},props:{msg:String,callback:Function},data:function(){return{activeMenu:null,activeEdit:null,activeAct:null,defi:[{col:"uid",hl:"UID",align:"left"},{col:"givenName",hl:"Firstname",align:"left"},{col:"sn",hl:"Lastname",align:"left"},{col:"homeDirectory",hl:"Home Dir",align:"left"},{col:"loginShell",hl:"Shell",align:"left"},{col:"employeeType",hl:"Role",align:"center"}],data:[],msgIn:"",fw_func:void 0,fwObj:{edit:this.form_user_edit,setpwd:this.form_user_setpwd,delete:this.fw_user_delete}}},mounted:function(){this.get_usr_data(),document.addEventListener("click",this.hide_menu)},beforeDestroy:function(){document.removeEventListener("click",this.hide_menu)},methods:{hide_menu:function(t){var e=t.target.getAttribute("tag");"menu"!=e&&(this.activeMenu=null)},reset_msg:function(){this.msgIn="",this.fw_func=void 0},get_usr_data:function(){var t=this;fetch("/api/users",{method:"GET"}).then((function(t){return t.json()})).then((function(e){console.log("Response:",e),e["data"]?t.data=e.data:t.msgIn="Something went wrong"})).catch((function(e){console.error("Error:",e),t.msgIn="Something went wrong"}))},set_active:function(t){"string"==typeof t&&(this.activeMenu=t)},reset_active:function(){this.activeMenu=null},reset_act:function(){this.activeEdit=null,this.activeAct=null},func_forward:function(t,e){this.reset_active(),this.fwObj[e](t)},form_user_create:function(){console.log("form create"),this.activeEdit="new",this.activeAct="create"},form_user_edit:function(t){console.log(t,"form edit"),this.activeEdit=t,this.activeAct="edit"},form_user_setpwd:function(t){console.log(t,"form setpwd"),this.activeEdit=t,this.activeAct="setpwd"},form_user_member:function(t){console.log(t,"form member")},fw_user_delete:function(t){var e=this;this.msgIn="Do you really want to delete this user "+t+"?",this.fw_func=function(){e.act_user_delete(t)}},act_user_delete:function(t){var e=this;console.log(t,"act delete");var n={uid:t};fetch("/api/user/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(t){return t.json()})).then((function(n){console.log("Response:",n),200==n.status?e.get_usr_data():e.msgIn="Failed to detele user "+t})).catch((function(n){console.error("Error:",n),e.msgIn="Failed to detele user "+t}))},guac_sync:function(){var t=this;console.log("guac_sync"),fetch("/api/users/sync",{method:"POST"}).then((function(t){return t.json()})).then((function(e){console.log("Response:",e),t.msgIn="ldap users successfully synced with guacamole"})).catch((function(e){console.error("Error:",e),t.msgIn="Failed to sync users with guacamole"}))}}},D=U,L=(n("3d6e"),Object(u["a"])(D,w,b,!1,null,"1495da6c",null)),J=L.exports,G={name:"App",components:{LoginForm:_,UserTable:J,MsgBox:m},data:function(){return{usr:!1,msgIn:""}},mounted:function(){this.chk_auth_state()},methods:{chk_auth_state:function(){var t=this;fetch("/api/auth/check",{method:"GET"}).then((function(t){return t.json()})).then((function(e){console.log("Response:",e),200==e.status&&void 0!=e.uid&&(t.usr=e.uid)})).catch((function(t){console.error("Error:",t)}))},set_usr:function(t){this.usr=t},logout:function(){var t=this,e={uid:this.usr};fetch("/api/auth/logout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(t){return t.json()})).then((function(e){200==e.status&&(t.usr=!1)})).catch((function(e){console.error("Error:",e),t.msgIn="Something went wrong"}))},open_vdi_url:function(){window.open("/vdi/")},reset_msg:function(){this.msgIn=""}}},H=G,z=(n("034f"),Object(u["a"])(H,s,r,!1,null,null,null)),Z=z.exports;o["a"].config.productionTip=!1,new o["a"]({render:function(t){return t(Z)}}).$mount("#app")},"608b":function(t,e,n){},"7b4c":function(t,e,n){},"85ec":function(t,e,n){},dea2:function(t,e,n){"use strict";n("23a6")},f1ed:function(t,e,n){"use strict";n("224b")}});
//# sourceMappingURL=app.964c1f77.js.map